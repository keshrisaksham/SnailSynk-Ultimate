<!-- Enhanced Notes Editor with Folders -->
{% extends "admin/admin_base.html" %}

{% block title %}Notes - SnailSynk{% endblock %}
{% block header_title %}Notes Editor{% endblock %}

{% block head %}
{{ super() }}
<!-- Quill Editor -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin-notes.css') }}">
{% endblock %}

{% block content %}
<div class="notes-container">
    <!-- Sidebar -->
    <aside class="notes-sidebar">
        <div class="sidebar-header">
            <h3>Notes</h3>
            <div class="sidebar-actions">
                <button id="newFolderBtn" class="btn-icon" title="New Folder">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                    </svg>
                </button>
                <button id="newNoteBtn" class="btn-icon" title="New Note">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="search-container">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="text" id="searchNotes" class="search-input" placeholder="Search notes...">
        </div>
        <div id="notesList" class="notes-list">
            <p class="loading">Loading...</p>
        </div>
    </aside>

    <!-- Editor -->
    <main class="editor-main">
        <div id="editorPlaceholder" class="editor-placeholder">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
            </svg>
            <h2>No Note Selected</h2>
            <p>Create or select a note to start editing</p>
        </div>

        <div id="editorContainer" class="editor-container" style="display: none;">
            <div class="editor-header">
                <input type="text" id="noteTitle" class="note-title" placeholder="Note Title">
                <div class="editor-actions">
                    <button id="previewBtn" class="btn" title="Toggle Preview">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                            <circle cx="12" cy="12" r="3" />
                        </svg>
                    </button>
                    <button id="markdownBtn" class="btn" title="Toggle Markdown Mode">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7" />
                            <path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2" />
                            <path d="M8 12h8" />
                            <path d="M10 9l-2 3 2 3" />
                            <path d="M14 9l2 3-2 3" />
                        </svg>
                    </button>
                    <button id="downloadBtn" class="btn" title="Download Note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                    </button>
                    <button id="exportPdfBtn" class="btn" title="Export as PDF">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                            <polyline points="14 2 14 8 20 8" />
                            <path d="M9 15h6" />
                            <path d="M9 11h6" />
                        </svg>
                    </button>
                    <button id="saveBtn" class="btn btn-primary">Save</button>
                    <button id="deleteBtn" class="btn btn-danger">Delete</button>
                </div>
            </div>
            <div id="editor"></div>
        </div>
    </main>
</div>

<!-- Context Menu -->
<div id="contextMenu" class="context-menu">
    <div class="context-menu-item" data-action="rename">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
        </svg>
        Rename
    </div>
    <div class="context-menu-item" data-action="duplicate">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
        </svg>
        Duplicate
    </div>
    <div class="context-menu-item" data-action="download">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
        </svg>
        Download
    </div>
    <div class="context-menu-item" data-action="exportPdf">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <path d="M9 15h6" />
            <path d="M9 11h6" />
        </svg>
        Export as PDF
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item danger" data-action="delete">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6" />
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
        </svg>
        Delete
    </div>
</div>

<!-- Unsaved Changes Modal -->
<div id="unsavedModal" class="notes-modal-overlay">
    <div class="notes-modal">
        <div class="notes-modal-header">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                <line x1="12" y1="9" x2="12" y2="13" />
                <line x1="12" y1="17" x2="12.01" y2="17" />
            </svg>
            <h3>Unsaved Changes</h3>
        </div>
        <p class="notes-modal-message">You have unsaved changes. What would you like to do?</p>
        <div class="notes-modal-actions">
            <button id="modalSaveBtn" class="btn btn-primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                    <polyline points="17 21 17 13 7 13 7 21" />
                    <polyline points="7 3 7 8 15 8" />
                </svg>
                Save & Continue
            </button>
            <button id="modalDiscardBtn" class="btn btn-danger">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6" />
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                </svg>
                Discard
            </button>
            <button id="modalCancelBtn" class="btn">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- Prompt Modal (for input dialogs) -->
<div id="promptModal" class="notes-modal-overlay">
    <div class="notes-modal">
        <div class="notes-modal-header">
            <svg id="promptIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M12 5v14M5 12h14" />
            </svg>
            <h3 id="promptTitle">Enter Name</h3>
        </div>
        <p id="promptMessage" class="notes-modal-message">Please enter a name:</p>
        <input type="text" id="promptInput" class="notes-modal-input" placeholder="Enter name...">
        <div class="notes-modal-actions">
            <button id="promptConfirmBtn" class="btn btn-primary">Confirm</button>
            <button id="promptCancelBtn" class="btn">Cancel</button>
        </div>
    </div>
</div>

<!-- Confirm Modal (for confirmations) -->
<div id="confirmModal" class="notes-modal-overlay">
    <div class="notes-modal">
        <div class="notes-modal-header">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="8" x2="12" y2="12" />
                <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <h3 id="confirmTitle">Confirm Action</h3>
        </div>
        <p id="confirmMessage" class="notes-modal-message">Are you sure?</p>
        <div class="notes-modal-actions">
            <button id="confirmYesBtn" class="btn btn-primary">Yes</button>
            <button id="confirmNoBtn" class="btn">No</button>
        </div>
    </div>
</div>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
{% endblock %}