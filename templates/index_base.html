<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SnailSynk{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='icon/favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile-responsive.css') }}">

    <!-- EasyMDE Markdown Editor -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde@2.18.0/dist/easymde.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/easymde-custom.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/easymde@2.18.0/dist/easymde.min.js"></script>

    <script>
        (function () {
            // Load theme
            const theme = localStorage.getItem('theme');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else if (theme === 'light') {
                document.documentElement.classList.remove('dark');
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            // Load accent color
            const accent = localStorage.getItem('accent') || 'red';
            document.documentElement.classList.add('accent-' + accent);
        })();
    </script>
    {% block head %}{% endblock %}
</head>

<body>
    <div id="fullPageDropZone" class="full-page-drop-zone">
        <div class="drop-zone-content">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="upload-icon">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <p>Drop Files Anywhere to Upload</p>
        </div>
    </div>

    <header class="app-header">
        <div class="app-container">
            <a href="{{ url_for('main.index') }}" class="logo">
                <img src="{{ url_for('static', filename='icon/favicon.png') }}" alt="SnailSynk Icon"
                    style="width: 40px; height: 40px;">
                <h1 id="snail">SnailSynk - Ultimate</h1>
            </a>

            <div class="header-actions">
                {% if is_admin %}
                <a href="{{ url_for('admin.monitoring') }}" class="btn btn-secondary" title="Admin Dashboard">Apps</a>
                <a href="{{ url_for('admin.logout') }}" class="btn btn-secondary">Logout</a>
                {% else %}
                <a href="{{ url_for('admin.login') }}" class="btn btn-secondary" title="Admin Login">Admin?</a>
                {% endif %}

                <button id="coffeeBtn" class="btn-icon" title="Buy me a coffee">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                        <line x1="6" y1="1" x2="6" y2="4"></line>
                        <line x1="10" y1="1" x2="10" y2="4"></line>
                        <line x1="14" y1="1" x2="14" y2="4"></line>
                    </svg>
                </button>

                <button id="connectBtn" class="btn-icon" title="Connect a device">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                        <line x1="14" y1="14" x2="14" y2="21"></line>
                        <line x1="21" y1="14" x2="21" y2="21"></line>
                        <line x1="14" y1="21" x2="21" y2="21"></line>
                    </svg>
                </button>
                <div class="accent-picker-wrapper">
                    <button id="accent-toggle" class="btn-icon" title="Change accent color">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="13.5" cy="6.5" r="2.5"></circle>
                            <circle cx="17.5" cy="10.5" r="2.5"></circle>
                            <circle cx="8.5" cy="7.5" r="2.5"></circle>
                            <circle cx="6.5" cy="12.5" r="2.5"></circle>
                            <path
                                d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z">
                            </path>
                        </svg>
                    </button>
                    <div id="accent-picker" class="accent-picker">
                        <button class="accent-option accent-red" data-accent="red" title="Red"></button>
                        <button class="accent-option accent-blue" data-accent="blue" title="Blue"></button>
                        <button class="accent-option accent-green" data-accent="green" title="Green"></button>
                        <button class="accent-option accent-purple" data-accent="purple" title="Purple"></button>
                        <button class="accent-option accent-orange" data-accent="orange" title="Orange"></button>
                        <button class="accent-option accent-black" data-accent="black" title="Black"></button>
                    </div>
                </div>
                <button id="theme-toggle" class="btn-icon" title="Toggle theme">
                    <span class="sun-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </span>
                    <span class="moon-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </span>
                </button>
            </div>
        </div>
    </header>

    <main class="app-container">
        {% block content %}{% endblock %}
    </main>

    <footer class="app-container">
        <p>Â© 2025 SnailSynk. Powered by YawnByte.</p>
    </footer>

    <div id="coffeeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Feedback & Support</h2>
                <button id="closeCoffeeModal" class="btn-icon modal-close-btn" title="Close"><svg
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg></button>
            </div>
            <div class="modal-body">
                <div class="modal-toggle-buttons">
                    <button id="showFeedbackQrBtn" class="btn btn-secondary active">Feedback</button>
                    <button id="showSupportQrBtn" class="btn btn-secondary">Support</button>
                </div>
                <div id="feedbackQrView">
                    <p class="modal-description">Scan to open my Instagram profile and send your feedback directly via
                        DM.</p>
                    <div class="qr-code-container" id="feedbackQrContainer">
                        <div class="spinner"></div>
                    </div>
                    <p class="qr-label">Instagram: <strong>@Sometimes.Saksham</strong></p>
                </div>
                <div id="supportQrView" style="display: none;">
                    <p class="modal-description">If you find this tool helpful, you can support its development by
                        scanning the UPI QR code.</p>
                    <div class="qr-code-container" id="coffeeQrContainer">
                        <div class="spinner"></div>
                    </div>
                    <p class="qr-label">UPI: <strong>kumarsaksham@yesg</strong></p>
                </div>
            </div>
        </div>
    </div>

    <button id="scrollPageBtn" class="btn-icon floating-scroll-btn" title="Scroll to Bottom">
        <span class="scroll-down-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14m-4-4 4 4 4-4" />
            </svg></span>
        <span class="scroll-up-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19V5m-4 4 4-4 4 4" />
            </svg></span>
    </button>

    <div id="imagePreviewPopup" class="image-preview-popup"></div>

    <div id="connectModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Connect a Device</h2>
                <button id="closeConnectModal" class="btn-icon modal-close-btn" title="Close"><svg
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg></button>
            </div>
            <div class="modal-body">
                <div class="view-toggle" style="justify-content: center;">
                    <span class="toggle-label">Server IP</span>
                    <label class="switch"><input type="checkbox" id="connectViewToggle"><span
                            class="slider round"></span></label>
                    <span class="toggle-label">Wi-Fi</span>
                </div>
                <div id="ipConnectView">
                    <p class="modal-description">Scan this QR code to open this page on your mobile device.</p>
                    <div class="qr-code-container" id="ipQrContainer">
                        <div class="spinner"></div>
                    </div>
                    <p class="qr-label">URL: <strong id="serverUrlLabel">http://{{ server_ip }}:<span
                                id="dynamicPort"></span></strong></p>
                    <script>document.getElementById('dynamicPort').textContent = location.port || '80';</script>
                </div>
                <div id="wifiConnectView" class="view-hidden">
                    <p class="modal-description">Your Wi-Fi name is pre-filled. Enter the password to generate a
                        connection QR code.</p>
                    <form id="wifiQrForm">
                        <div class="form-group">
                            <label for="wifiSSID">Network Name (SSID)</label>
                            <input type="text" id="wifiSSID" name="ssid" placeholder="Could not detect Wi-Fi" required
                                value="{{ current_ssid or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="wifiPassword">Password</label>
                            <input type="password" id="wifiPassword" name="password" placeholder="Your Wi-Fi password">
                        </div>
                        <button type="submit" id="generateWifiQrBtn" class="btn btn-primary">Generate QR Code</button>
                    </form>
                    <div class="qr-code-container" id="wifiQrContainer" style="margin-top: 1.5rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="passwordModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 380px;">
            <div class="modal-header">
                <h2 id="passwordModalTitle">Enter Password</h2>
                <button id="closePasswordModal" class="btn-icon modal-close-btn" title="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="passwordModalDescription" class="modal-description">This file is password protected. Please enter
                    the password to download.</p>
                <form id="passwordModalForm">
                    <input type="hidden" id="passwordModalFilename">
                    <div class="form-group">
                        <label for="filePasswordInput">Password</label>
                        <input type="password" id="filePasswordInput" required autocomplete="current-password">
                        <p id="passwordModalError"
                            style="color:var(--c-error-text); font-size:0.8rem; min-height:1.2em; margin-top:0.5em;">
                        </p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%;">Download</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/backbone.js') }}"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin-dashboard.js') }}"></script>
</body>

</html>